<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="/">
    <title>Create Your Intro Card</title>
    <link rel="stylesheet" href="../../stylesheets/createCardStyle.css">
    <link rel="stylesheet" type="text/css" href="../../stylesheets/navbar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <nav class="navbar">
        <div class="nav-logo">
            <a href="/"><img src="#" alt="Logo" id="nav-logo-img"></a>
        </div>
        <div class="nav-items">
            <a href="/NavBarOptions/CreateCard/CreateCard.html">Create Card</a>
            <a href="/NavBarOptions/Gallery/Gallery.html">Gallery</a>
            <a href="/option3">Resources</a>
        </div>
        <div class="nav-user">
            <a href="/dashboard" id="profile-link">
                <div class="image-1Psl69" alt="User" id="avatar"></div>
            </a>
        </div>
    </nav>

    <div class="container">
        <h1>Create Your Custom Intro Card</h1>
        
        <!-- Form for creating an intro card -->
        <form id="introCardForm">
            <!-- Section for choosing a template -->
            <section class="form-section">
                <label for="template">Choose a template:</label>
                <select id="template" name="template">
                    <option value="classic">Classic</option>
                    <option value="modern">Modern</option>
                    <option value="abstract">Abstract</option>
                </select>
            </section>

            <!-- Section for choosing a color scheme -->
            <section class="form-section">
                <label for="color">Choose a color scheme:</label>
                <input type="color" id="color" name="color" value="#000000">
            </section>

            <!-- Section for entering text -->
            <section class="form-section">
                <label for="username">Enter your username:</label>
                <input type="text" id="username" name="username" placeholder="Your Discord Username">
            </section>

            <!-- Section for uploading an image -->
            <section class="form-section">
                <label for="imageUpload">Upload an image:</label>
                <input type="file" id="imageUpload" name="imageUpload">
            </section>

            <!-- Section for creating the intro card -->
            <section class="form-section">
                <button type="button" id="createBtn">Create Intro Card</button>
            </section>
        </form>

        <!-- Display the created intro card -->
        <div id="introCardDisplay" class="intro-card">
            <p>Preview your intro card here...</p>
        </div>
    </div>

    <script src="public/NavBarOptions/CreateCard/createCardScript.js"></script>
    <script>
        window.onload = () => {
            const accessToken = localStorage.getItem('accessToken') || getCookie('accessToken');
    
            if (!accessToken) {
                window.location.href = '/';
                return;
            }
    
            fetch('https://discord.com/api/users/@me', {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            })
            .then(result => result.json())
            .then(data => {
                console.log(data); // Process and display gallery data
            })
            .catch(console.error);
    
            function getCookie(name) {
                let cookie = {};
                document.cookie.split(';').forEach(function (el) {
                    let [k, v] = el.split('=');
                    cookie[k.trim()] = v;
                });
                return cookie[name];
            }

            fetch('https://discord.com/api/users/@me', {
                headers: {
                    authorization: `Bearer ${accessToken}`,
                },
            })
            // Avatar Icon Script Extended
                .then(result => result.json())
                .then(response => {
                    console.log(response);
                    const { avatar, id } = response;

                    //set the avatar image by constructing a url to access discord's cdn
                    // document.getElementById("avatar").src = `https://cdn.discordapp.com/avatars/${id}/${avatar}.jpg`;

                    document.querySelector('.image-1Psl69').style.backgroundImage = `url("https://cdn.discordapp.com/avatars/${id}/${avatar}")`;
                    
                    document.getElementById("profile-link").href = `/auth/discord#token_type=Bearer&access_token=${accessToken}&expires_in=604800&scope=identify`;
                })
                .catch(console.error);
        };
    </script>
</body>
</html>
